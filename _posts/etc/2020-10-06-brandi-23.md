---
title: "[201006] brandi day 23"
categories: etc
---

ìƒí’ˆ ì •ë³´ë¥¼ insert í•˜ëŠ” DAO ì—ì„œ ìƒí’ˆ ì •ë³´ë¥¼ ê°ê° í•´ë‹¹í•˜ëŠ” ì—¬ëŸ¬ ê°œì˜ í…Œì´ë¸”ì— ì…ë ¥í•´ì£¼ì–´ì•¼ í•œë‹¤.
```py
# 1. products í…Œì´ë¸”ì— ë°ì´í„° insert
insert_query = """
INSERT INTO products
(
    created_at,
    is_deleted
) VALUES (
    now(),
    0
)
"""
row = session.execute(insert_query).lastrowid
# 2. product_info í…Œì´ë¸”ì— ë°ì´í„° insert
product_info['product_id'] = row
# ì´ë¯¸ì§€ ë¦¬ìŠ¤íŠ¸ë¥¼ ê°€ì ¸ì™€ ì²« ë²ˆì§¸ ì´ë¯¸ì§€ë¥¼ ëŒ€í‘œì´ë¯¸ì§€ë¡œ ì €ì¥
insert_query = """
INSERT INTO product_info
(   
    product_id,
    product_code,
    seller_id,
    is_on_sale,
    is_displayed,
    name,
    simple_description,
    detail_description,
    price,
    discount_rate,
...(ìƒëµ)
) VALUES (
    :product_id,
    :product_code,
    :seller_id,
    :is_on_sale,
    :is_displayed,
    :name,
    :simple_description,
    :detail_description,
    :price,
...(ìƒëµ)
)
"""

row = session.execute(insert_query, product_info).lastrowid
```

ìœ„ì™€ ê°™ì´ ```products``` í…Œì´ë¸”ì—ì„œ ìƒí’ˆì˜ id ë¥¼ ì •ì˜í•´ì£¼ë©´ ê·¸ ì•„ì´ë””ë¥¼ ```lastrowid``` ë¡œ ë°›ì•„ì˜¤ê³  ```product_info``` í…Œì´ë¸”ì˜ ```product_id``` ì»¬ëŸ¼ì— ì…ë ¥í•´ì£¼ë„ë¡ í•˜ì˜€ë‹¤. ê·¸ëŸ°ë° ```INSERT``` ê°€ ì‹¤íŒ¨í•œ ê²½ìš° ```lastlowid``` ê°€ ë°˜í™˜ì´ ë˜ì§€ ì•Šì„ ìˆ˜ë„ ìˆë‹¤. í•˜ì§€ë§Œ ì§€ê¸ˆì€ ```INSERT``` ë§ˆë‹¤ ì´ë¥¼ ì²˜ë¦¬í•˜ëŠ” ì½”ë“œê°€ ì—†ëŠ” ìƒíƒœì¸ë° ì´ì— ëŒ€í•œ í”¼ë“œë°±ì„ ë°›ê²Œ ë˜ì—ˆë‹¤. 

```py
if row <= 0
    raise sqlAlchemyError
```
ë”°ë¼ì„œ ìœ„ì™€ ê°™ì´ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ê³  ì ìš©ëœ row ì˜ ìˆ˜ê°€ 0 ì´í•˜ì¼ ê²½ìš°ì— sqlAlchemy ì˜ ì—ëŸ¬ë¥¼ ë°œìƒì‹œí‚¤ë ¤ í–ˆëŠ”ë° ê·¸ ì „ì— ì¼ë¶€ëŸ¬ ì—ëŸ¬ë¥¼ ë‚´ë³´ê³  ì–´ë–»ê²Œ ì²˜ë¦¬ë˜ëŠ”ì§€ í™•ì¸ì„ í•´ë³´ì•˜ë‹¤. 

ì´ë¯¸ ìˆëŠ” row ì˜ id ì— ë°ì´í„°ë¥¼ ì…ë ¥í•˜ì—¬ ì¼ë¶€ëŸ¬ ì—ëŸ¬ë¥¼ ë°œìƒì‹œì¼°ë‹¤.

![error](https://user-images.githubusercontent.com/26542094/95579580-e173a700-0a70-11eb-8d82-ca38f267c5f6.png)

í¬ìŠ¤íŠ¸ë§¨ìœ¼ë¡œ ìƒí’ˆ ë“±ë¡ API ë¥¼ í˜¸ì¶œí•˜ê³  ê²°ê³¼ë¥¼ í™•ì¸í•˜ë©´ dao ì—ì„œ ì—ëŸ¬ë¥¼ ì¡ì•„ì£¼ì§€ ì•Šì•„ë„ controller ì—ì„œ ì¡ì€ ```Exeption``` ì—ì„œ ì—ëŸ¬ê°€ ì¡íˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆë‹¤. 
ì´ ì¼€ì´ìŠ¤ë¥¼ í†µí•´ í™•ì¸ í•  ìˆ˜ ìˆëŠ” ê²ƒì€ model ë˜ëŠ” service ë ˆì´ì–´ì—ì„œ ë”°ë¡œ ì—ëŸ¬ë¥¼ ì¡ì•„ì£¼ì§€ ì•Šì•„ë„ ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ view ë ˆì´ì–´ë¡œ ì˜¬ë¼ê°€ì„œ ì—ëŸ¬ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì´ì—ˆë‹¤ ğŸ˜®

ì§€ê¸ˆì€ ì € ì—ëŸ¬ë¥¼ ë”°ë¡œ ì¡ì•„ì£¼ì§€ ì•Šì•„ sql ë¬¸ê³¼ í•¨ê»˜ ì—ëŸ¬ ë©”ì„¸ì§€ê°€ ë°˜í™˜ë˜ëŠ”ë° sql ë¬¸ì´ ë…¸ì¶œë˜ì§€ ì•Šë„ë¡ IntegrityError ë“±ì„ ì„¸ì„¸í•˜ê²Œ ê´€ë¦¬í•´ì¤„ í•„ìš”ì„±ì„ ëŠê¼ˆë‹¤!

í˜„ì¬ëŠ” ì•„ë˜ì™€ ê°™ì´ ì—ëŸ¬ ì½”ë“œë¥¼ ì¶”ê°€í•´ì£¼ì—ˆë‹¤. 
```py
except exc.IntegrityError:
    return jsonify({'message': 'DUPLICATE_DATA'}), 400
    
except exc.InvalidRequestError:
    return jsonify(({'message' : 'INVALID_REQUEST'})), 400

except exc.ProgrammingError:
    return jsonify(({'message': 'ERROR_IN_SQL_SYNTAX'})), 400
```